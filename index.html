<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Architecture of Ideas</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />

    <meta property="og:title" content="Architecture of Ideas" />
    <meta property="og:description" content="Strategy, Product, Brand." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://oscarvalledor.com" />
    <meta property="og:image" content="https://oscarvalledor.com/og-image.svg" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Architecture of Ideas" />
    <meta name="twitter:description" content="Strategy, Product, Brand." />
    <meta name="twitter:image" content="https://oscarvalledor.com/og-image.svg" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>

    <div class="page">

      <div class="top">
        <span>Oscar Valledor - <em>Architecture of Ideas</em></span>
      </div>

      <div class="middle">
        <p>Strategy, Product, Brand.</p>
      </div>

      <div class="bottom">
        <div class="bottom-left">
          <p id="quote" aria-live="polite"></p>
          <div class="bottom-meta">
            <a href="#" data-view="colophon" class="copyright">© 2026</a>
            <div id="present" aria-live="polite">
              <span id="present-city"></span>
              <span id="present-coords"></span>
              <span id="present-time"></span>
              <span id="present-weather"></span>
              <span id="present-moon"></span>
            </div>
          </div>
        </div>
        <nav>
          <a href="#" data-view="now">Now</a>
          <a href="#" data-view="essays">Essays</a>
          <a href="#" data-view="projects">Work</a>
          <a href="#" data-view="books">Books</a>
          <a href="#" data-view="contact">Contact</a>
        </nav>
      </div>

      <!-- Books -->
      <div id="books-view" class="overlay-view">
        <div class="view-list"></div>
        <div class="view-footer">
          <span id="books-count"></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Projects -->
      <div id="projects-view" class="overlay-view">
        <div class="view-list"></div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Writing -->
      <div id="essays-view" class="overlay-view">
        <div class="view-list"></div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Contact -->
      <div id="contact-view" class="overlay-view">
        <div class="view-list">
          <p><a href="https://instagram.com/oscarvalledor" target="_blank" rel="noopener noreferrer">Instagram</a></p>
          <p><a href="https://www.linkedin.com/in/oscarvalledor/" target="_blank" rel="noopener noreferrer">LinkedIn</a></p>
          <p><a href="mailto:ovalledor@gmail.com">Email</a></p>
        </div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Shortcuts -->
      <div id="shortcuts-view" class="overlay-view">
        <div class="view-list">
          <p><span class="shortcut-key">N</span><span class="view-meta"> — Now</span></p>
          <p><span class="shortcut-key">E</span><span class="view-meta"> — Essays</span></p>
          <p><span class="shortcut-key">W</span><span class="view-meta"> — Work</span></p>
          <p><span class="shortcut-key">B</span><span class="view-meta"> — Books</span></p>
          <p><span class="shortcut-key">C</span><span class="view-meta"> — Contact</span></p>
          <p><span class="shortcut-key">M</span><span class="view-meta"> — Moon</span></p>
          <p><span class="shortcut-key">?</span><span class="view-meta"> — This panel</span></p>
          <p><span class="shortcut-key">Esc</span><span class="view-meta"> — Close</span></p>
        </div>
        <div class="view-footer">
          <span>Keyboard shortcuts</span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Colophon -->
      <div id="colophon-view" class="overlay-view">
        <div class="view-list">
          <p>Built with HTML, CSS, and vanilla JavaScript.</p>
          <p>Typeset in Times New Roman.</p>
          <p>Hosted on GitHub Pages.</p>
          <p>Books synced from Goodreads. Quotes from <a href="https://fs.blog/brain-food/" target="_blank" rel="noopener noreferrer">Brain Food</a>.</p>
          <p>Adapts to your system's colour preference.</p>
          <p>Press <em>?</em> for keyboard shortcuts.</p>
        </div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Moon -->
      <div id="moon-view" class="overlay-view">
        <div class="view-list">
          <p id="moon-phase"></p>
          <p id="moon-detail" class="view-meta"></p>
        </div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Konami -->
      <div id="konami-view" class="overlay-view">
        <div class="view-list">
          <p>You found it.</p>
          <p>Most things worth finding aren't indexed.</p>
          <p>Keep looking.</p>
        </div>
        <div class="view-footer">
          <span></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

      <!-- Now -->
      <div id="now-view" class="overlay-view" data-updated="2026-02-26">
        <div class="now-body">
          <div class="view-list">
            <p>Based in Barcelona.<br>
            Interested in consumer, artificial intelligence &amp; health.</p>
            <p>Exploratory phase.</p>
          </div>
          <img src="tree.svg" class="now-tree" alt="" aria-hidden="true">
        </div>
        <div class="view-footer">
          <span id="now-updated"></span>
          <nav><a href="#" class="view-close">Close</a></nav>
        </div>
      </div>

    </div>

  <script src="present.js"></script>
  <script>
    const page = document.querySelector('.page');

    // — Page fade-in —
    setTimeout(function() { page.classList.add('is-ready'); }, 100);

    // — Quote (rotates every 4 minutes) —
    (async function () {
      try {
        const res = await fetch('quotes.json');
        const data = await res.json();
        if (!data.quotes || !data.quotes.length) return;
        const quotes = data.quotes;
        const el = document.getElementById('quote');
        let current = Math.floor(Math.random() * quotes.length);

        function showQuote(q) {
          el.classList.remove('is-ready');
          setTimeout(function() {
            el.textContent = q.text;
            el.title = q.edition;
            el.classList.add('is-ready');
          }, 400);
        }

        showQuote(quotes[current]);

        setInterval(function() {
          let next;
          do { next = Math.floor(Math.random() * quotes.length); }
          while (next === current && quotes.length > 1);
          current = next;
          showQuote(quotes[current]);
        }, 4 * 60 * 1000);
      } catch (e) {}
    })();

    // — View system —
    function openView(name) {
      if (page.dataset.view === name) { closeView(); return; }
      page.dataset.view = name;
      loadView(name);
    }

    function closeView() {
      delete page.dataset.view;
    }

    document.querySelectorAll('[data-view]').forEach(el => {
      if (el.tagName === 'A') {
        el.addEventListener('click', function(e) {
          e.preventDefault();
          openView(this.dataset.view);
        });
      }
    });

    document.querySelectorAll('.view-close').forEach(el => {
      el.addEventListener('click', function(e) {
        e.preventDefault();
        closeView();
      });
    });

    // — Tab title clock —
    let titleTimer = null;
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        function tickTitle() {
          const now = new Date();
          document.title = [
            String(now.getHours()).padStart(2, '0'),
            String(now.getMinutes()).padStart(2, '0'),
            String(now.getSeconds()).padStart(2, '0'),
          ].join(':');
        }
        tickTitle();
        titleTimer = setInterval(tickTitle, 1000);
      } else {
        clearInterval(titleTimer);
        document.title = 'Architecture of Ideas';
      }
    });

    // — Hello easter egg —
    function triggerHello() {
      if (document.querySelector('.hello-flash')) return;
      const el = document.createElement('div');
      el.className = 'hello-flash';
      el.textContent = 'hola.';
      document.body.appendChild(el);
      requestAnimationFrame(function() { el.classList.add('is-visible'); });
      setTimeout(function() {
        el.classList.remove('is-visible');
        setTimeout(function() { el.remove(); }, 600);
      }, 2500);
    }

    // — Konami code —
    const konamiSeq = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
    let konamiPos = 0;

    // — Keyboard shortcuts —
    let typedBuffer = '';
    document.addEventListener('keydown', function(e) {
      if (e.metaKey || e.ctrlKey || e.altKey) return;
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

      // Konami (works regardless of open view)
      if (e.key === konamiSeq[konamiPos]) {
        konamiPos++;
        if (konamiPos === konamiSeq.length) {
          konamiPos = 0;
          openView('konami');
          return;
        }
      } else {
        konamiPos = e.key === konamiSeq[0] ? 1 : 0;
      }

      if (e.key === 'Escape') { closeView(); return; }
      if (e.key === '?') {
        page.dataset.view === 'shortcuts' ? closeView() : openView('shortcuts');
        return;
      }
      if (page.dataset.view) return;

      // Hello detection
      if (e.key.length === 1) {
        typedBuffer = (typedBuffer + e.key).slice(-10);
        if (typedBuffer.toLowerCase().includes('hola')) {
          typedBuffer = '';
          triggerHello();
          return;
        }
      }

      const shortcuts = { b: 'books', n: 'now', e: 'essays', w: 'projects', c: 'contact', m: 'moon' };
      const view = shortcuts[e.key.toLowerCase()];
      if (view) openView(view);
    });

    // — Books —
    let booksData = null;

    async function loadBooks() {
      if (booksData) return booksData;
      const res = await fetch('books.json');
      booksData = await res.json();
      return booksData;
    }

    function renderBooks(data) {
      const list = document.querySelector('#books-view .view-list');
      list.innerHTML = '';

      const sections = [
        { label: 'Currently reading', items: data.currentlyReading },
        { label: null, items: data.read },
      ];

      for (const section of sections) {
        if (!section.items.length) continue;
        if (section.label) {
          const label = document.createElement('p');
          label.className = 'view-label';
          label.textContent = section.label;
          list.appendChild(label);
        }
        for (const book of section.items) {
          const p = document.createElement('p');
          const a = document.createElement('a');
          a.href = book.url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = `${book.title} — ${book.author}`;
          p.appendChild(a);
          list.appendChild(p);
        }
      }

      const count = data.read.length;
      document.getElementById('books-count').textContent = count;
    }

    // — Projects —
    let projectsData = null;

    async function loadProjects() {
      if (projectsData) return projectsData;
      const res = await fetch('projects.json');
      projectsData = await res.json();
      return projectsData;
    }

    function renderProjects(data) {
      const list = document.querySelector('#projects-view .view-list');
      list.innerHTML = '';
      for (const project of data.projects.filter(p => !p.hidden)) {
        const p = document.createElement('p');

        if (project.url) {
          const a = document.createElement('a');
          a.href = project.url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = project.title;
          p.appendChild(a);
        } else {
          p.appendChild(document.createTextNode(project.title));
        }

        if (project.status) {
          const span = document.createElement('span');
          span.className = 'view-meta';
          span.textContent = ` — ${project.status}`;
          p.appendChild(span);
        }

        list.appendChild(p);
      }
    }

    // — Writing —
    let essaysData = null;

    async function loadEssays() {
      if (essaysData) return essaysData;
      const res = await fetch('essays.json');
      essaysData = await res.json();
      return essaysData;
    }

    function renderEssays(data) {
      const list = document.querySelector('#essays-view .view-list');
      list.innerHTML = '';
      if (!data.posts.length) {
        const p = document.createElement('p');
        p.className = 'view-meta';
        p.textContent = 'Nothing published yet.';
        list.appendChild(p);
        return;
      }
      for (const post of data.posts) {
        const p = document.createElement('p');
        if (post.slug) {
          const a = document.createElement('a');
          a.href = `essays/${post.slug}.html`;
          a.textContent = post.title;
          p.appendChild(a);
        } else {
          p.appendChild(document.createTextNode(post.title));
        }
        const metaParts = [];
        if (post.author) metaParts.push(post.author);
        if (post.date) metaParts.push(post.date);
        if (metaParts.length) {
          const meta = document.createElement('span');
          meta.className = 'view-meta';
          meta.textContent = ` — ${metaParts.join(', ')}`;
          p.appendChild(meta);
        }
        list.appendChild(p);
      }
    }

    // — Now —
    (function () {
      const d = new Date(document.getElementById('now-view').dataset.updated);
      const label = d.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      document.getElementById('now-updated').textContent = `Last updated ${label}`;
    })();

    // — Moon —
    document.getElementById('present-moon').addEventListener('click', function() {
      openView('moon');
    });

    function renderMoon() {
      const knownNewMoon = new Date('2000-01-06T18:14:00Z');
      const lunarCycle = 29.53059;
      const elapsed = (Date.now() - knownNewMoon.getTime()) / 86400000;
      const dayInCycle = ((elapsed % lunarCycle) + lunarCycle) % lunarCycle;
      const phase = dayInCycle / lunarCycle;

      let phaseName;
      if (phase < 0.0625 || phase >= 0.9375) phaseName = 'New Moon';
      else if (phase < 0.1875) phaseName = 'Waxing Crescent';
      else if (phase < 0.3125) phaseName = 'First Quarter';
      else if (phase < 0.4375) phaseName = 'Waxing Gibbous';
      else if (phase < 0.5625) phaseName = 'Full Moon';
      else if (phase < 0.6875) phaseName = 'Waning Gibbous';
      else if (phase < 0.8125) phaseName = 'Last Quarter';
      else phaseName = 'Waning Crescent';

      const daysToFull = dayInCycle < 14.77 ? 14.77 - dayInCycle : lunarCycle - dayInCycle + 14.77;
      const daysToNew = lunarCycle - dayInCycle;

      document.getElementById('moon-phase').textContent = phaseName;
      document.getElementById('moon-detail').textContent =
        `Day ${Math.floor(dayInCycle) + 1} of 30 · Full moon in ${Math.ceil(daysToFull)} day${Math.ceil(daysToFull) === 1 ? '' : 's'} · New moon in ${Math.ceil(daysToNew)} days`;
    }

    async function loadView(name) {
      if (name === 'books') renderBooks(await loadBooks());
      if (name === 'projects') renderProjects(await loadProjects());
      if (name === 'essays') renderEssays(await loadEssays());
      if (name === 'moon') renderMoon();
    }
  </script>
  </body>
</html>
